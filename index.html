<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#1c1c1e">
  <title>Pomodoro Study Timer</title>
  <style>
    :root {
      --bg: #f2f2f7;
      --surface: #ffffff;
      --text: #1c1c1e;
      --text-secondary: #8e8e93;
      --accent: #007aff;
      --accent-dim: #5ac8fa;
      --focus-bg: #34c759;
      --break-bg: #af52de;
      --danger: #ff3b30;
      --radius: 16px;
      --radius-sm: 12px;
      --shadow: 0 4px 24px rgba(0,0,0,0.08);
      --safe-top: env(safe-area-inset-top, 0);
      --safe-bottom: env(safe-area-inset-bottom, 0);
    }

    [data-theme="dark"] {
      --bg: #000000;
      --surface: #1c1c1e;
      --text: #f5f5f7;
      --text-secondary: #8e8e93;
      --accent: #0a84ff;
      --accent-dim: #64d2ff;
      --focus-bg: #30d158;
      --break-bg: #bf5af2;
      --danger: #ff453a;
      --shadow: 0 4px 24px rgba(0,0,0,0.4);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", "Helvetica Neue", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      min-height: 100dvh;
      padding: var(--safe-top) 20px var(--safe-bottom);
      -webkit-font-smoothing: antialiased;
    }

    .app {
      max-width: 400px;
      margin: 0 auto;
      min-height: 100vh;
      min-height: 100dvh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: max(24px, var(--safe-top));
    }

    header {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
    }

    h1 {
      font-size: 22px;
      font-weight: 600;
      letter-spacing: -0.02em;
    }

    .toggle-wrap {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .toggle-label {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .toggle {
      width: 51px;
      height: 31px;
      background: var(--text-secondary);
      border-radius: 31px;
      position: relative;
      cursor: pointer;
      transition: background 0.25s;
    }

    .toggle.on {
      background: var(--accent);
    }

    .toggle::after {
      content: "";
      position: absolute;
      width: 27px;
      height: 27px;
      background: #fff;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: transform 0.25s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .toggle.on::after {
      transform: translateX(20px);
    }

    .stats {
      width: 100%;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: var(--surface);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
    }

    .stat-label {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }

    .stat-value {
      font-size: 24px;
      font-weight: 600;
      letter-spacing: -0.02em;
    }

    .mode-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 32px;
    }

    .mode-btn {
      padding: 10px 24px;
      border: none;
      border-radius: var(--radius-sm);
      font-size: 15px;
      font-weight: 500;
      background: var(--surface);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: var(--shadow);
    }

    .mode-btn.active {
      background: var(--accent);
      color: #fff;
    }

    .mode-btn:not(.active):hover {
      background: var(--surface);
      color: var(--text);
    }

    .timer-wrap {
      width: 100%;
      aspect-ratio: 1;
      max-width: 280px;
      margin: 0 auto 32px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .timer-ring {
      position: absolute;
      inset: 0;
      border-radius: 50%;
      border: 6px solid var(--surface);
      box-shadow: var(--shadow);
    }

    .timer-ring-progress {
      position: absolute;
      inset: 0;
      border-radius: 50%;
      transition: background 0.1s linear;
    }

    .timer-display {
      position: relative;
      z-index: 1;
      text-align: center;
    }

    .timer-time {
      font-size: 56px;
      font-weight: 200;
      letter-spacing: -0.03em;
      line-height: 1;
      font-variant-numeric: tabular-nums;
    }

    .timer-label {
      font-size: 15px;
      color: var(--text-secondary);
      margin-top: 8px;
    }

    .controls {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn {
      padding: 14px 28px;
      border: none;
      border-radius: var(--radius-sm);
      font-size: 17px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.1s, opacity 0.2s;
      -webkit-tap-highlight-color: transparent;
    }

    .btn:active {
      transform: scale(0.97);
    }

    .btn-primary {
      background: var(--accent);
      color: #fff;
      min-width: 120px;
    }

    .btn-primary.paused {
      background: var(--focus-bg);
    }

    .btn-secondary {
      background: var(--surface);
      color: var(--text);
      box-shadow: var(--shadow);
    }

    .btn-danger {
      background: var(--danger);
      color: #fff;
    }

    @media (max-width: 380px) {
      .timer-time {
        font-size: 48px;
      }
      .controls {
        flex-direction: column;
      }
      .btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Study Timer</h1>
      <div class="toggle-wrap">
        <span class="toggle-label">Dark</span>
        <button type="button" class="toggle" id="darkToggle" aria-label="Toggle dark mode"></button>
      </div>
    </header>

    <div class="stats">
      <div class="stat-card">
        <div class="stat-label">Today</div>
        <div class="stat-value" id="todayMins">0 min</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Streak</div>
        <div class="stat-value" id="streakCount">0 days</div>
      </div>
    </div>

    <div class="mode-tabs">
      <button type="button" class="mode-btn active" data-mode="focus">Focus (25m)</button>
      <button type="button" class="mode-btn" data-mode="break">Break (5m)</button>
    </div>

    <div class="timer-wrap">
      <div class="timer-ring"></div>
      <div class="timer-ring-progress" id="timerRing"></div>
      <div class="timer-display">
        <div class="timer-time" id="timerDisplay">25:00</div>
        <div class="timer-label" id="timerLabel">Focus</div>
      </div>
    </div>

    <div class="controls">
      <button type="button" class="btn btn-primary" id="startBtn">Start</button>
      <button type="button" class="btn btn-secondary" id="pauseBtn" disabled>Pause</button>
      <button type="button" class="btn btn-secondary btn-danger" id="resetBtn">Reset</button>
    </div>
  </div>

  <script>
    (function () {
      const FOCUS_SEC = 25 * 60;
      const BREAK_SEC = 5 * 60;
      const STORAGE_KEYS = {
        darkMode: 'pomodoro-dark',
        todayMins: 'pomodoro-today',
        todayDate: 'pomodoro-today-date',
        streak: 'pomodoro-streak',
        lastDate: 'pomodoro-last-date',
      };

      let mode = 'focus';
      let remaining = FOCUS_SEC;
      let total = FOCUS_SEC;
      let intervalId = null;
      let todayMins = 0;
      let streak = 0;

      const $ = (id) => document.getElementById(id);
      const timerDisplay = $('timerDisplay');
      const timerLabel = $('timerLabel');
      const timerRing = $('timerRing');
      const startBtn = $('startBtn');
      const pauseBtn = $('pauseBtn');
      const resetBtn = $('resetBtn');
      const darkToggle = $('darkToggle');
      const todayEl = $('todayMins');
      const streakEl = $('streakCount');

      function loadState() {
        const dark = localStorage.getItem(STORAGE_KEYS.darkMode);
        if (dark === '1') {
          document.documentElement.setAttribute('data-theme', 'dark');
          darkToggle.classList.add('on');
        }
        const savedDate = localStorage.getItem(STORAGE_KEYS.todayDate);
        const today = getTodayKey();
        if (savedDate === today) {
          todayMins = parseInt(localStorage.getItem(STORAGE_KEYS.todayMins) || '0', 10);
        } else {
          todayMins = 0;
          localStorage.setItem(STORAGE_KEYS.todayDate, today);
          localStorage.setItem(STORAGE_KEYS.todayMins, '0');
        }
        streak = parseInt(localStorage.getItem(STORAGE_KEYS.streak) || '0', 10);
        const lastDate = localStorage.getItem(STORAGE_KEYS.lastDate);
        if (lastDate) {
          const yesterday = getYesterdayKey();
          if (lastDate !== today && lastDate !== yesterday) streak = 0;
        }
        renderStats();
      }

      function getTodayKey() {
        const d = new Date();
        return d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0');
      }

      function getYesterdayKey() {
        const d = new Date();
        d.setDate(d.getDate() - 1);
        return d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0');
      }

      function saveToday() {
        localStorage.setItem(STORAGE_KEYS.todayMins, String(todayMins));
        localStorage.setItem(STORAGE_KEYS.todayDate, getTodayKey());
      }

      function saveStreak() {
        const today = getTodayKey();
        const lastDate = localStorage.getItem(STORAGE_KEYS.lastDate);
        if (lastDate !== today) {
          const yesterday = getYesterdayKey();
          if (lastDate === yesterday) streak += 1;
          else if (!lastDate || lastDate < yesterday) streak = 1;
          localStorage.setItem(STORAGE_KEYS.streak, String(streak));
          localStorage.setItem(STORAGE_KEYS.lastDate, today);
        }
        renderStats();
      }

      function renderStats() {
        todayEl.textContent = todayMins + ' min';
        streakEl.textContent = streak === 1 ? '1 day' : streak + ' days';
      }

      function formatTime(sec) {
        const m = Math.floor(sec / 60);
        const s = sec % 60;
        return String(m).padStart(2, '0') + ':' + String(s).padStart(2, '0');
      }

      function updateRing() {
        const pct = total > 0 ? (remaining / total) : 0;
        const deg = 360 * (1 - pct);
        const color = mode === 'focus' ? 'var(--focus-bg)' : 'var(--break-bg)';
        const conic = `conic-gradient(${color} 0deg, ${color} ${deg}deg, transparent ${deg}deg)`;
        const radial = 'radial-gradient(circle at center, var(--surface) calc(50% - 6px), transparent calc(50% - 6px))';
        timerRing.style.background = radial + ', ' + conic;
      }

      function tick() {
        if (remaining <= 0) {
          clearInterval(intervalId);
          intervalId = null;
          if (mode === 'focus') {
            todayMins += 25;
            saveToday();
            saveStreak();
          }
          mode = mode === 'focus' ? 'break' : 'focus';
          total = mode === 'focus' ? FOCUS_SEC : BREAK_SEC;
          remaining = total;
          document.querySelectorAll('.mode-btn').forEach((b) => b.classList.toggle('active', b.dataset.mode === mode));
          timerLabel.textContent = mode === 'focus' ? 'Focus' : 'Break';
          startBtn.textContent = 'Start';
          startBtn.disabled = false;
          pauseBtn.disabled = true;
          updateRing();
        } else {
          remaining--;
        }
        timerDisplay.textContent = formatTime(remaining);
        updateRing();
      }

      function start() {
        if (intervalId) return;
        startBtn.textContent = 'Running';
        startBtn.classList.add('paused');
        startBtn.disabled = true;
        pauseBtn.disabled = false;
        intervalId = setInterval(tick, 1000);
      }

      function pause() {
        if (!intervalId) return;
        clearInterval(intervalId);
        intervalId = null;
        startBtn.textContent = 'Start';
        startBtn.classList.remove('paused');
        startBtn.disabled = false;
        pauseBtn.disabled = true;
      }

      function reset() {
        pause();
        total = mode === 'focus' ? FOCUS_SEC : BREAK_SEC;
        remaining = total;
        timerDisplay.textContent = formatTime(remaining);
        timerLabel.textContent = mode === 'focus' ? 'Focus' : 'Break';
        updateRing();
      }

      function setMode(newMode) {
        if (intervalId) return;
        mode = newMode;
        total = mode === 'focus' ? FOCUS_SEC : BREAK_SEC;
        remaining = total;
        document.querySelectorAll('.mode-btn').forEach((b) => b.classList.toggle('active', b.dataset.mode === mode));
        timerDisplay.textContent = formatTime(remaining);
        timerLabel.textContent = mode === 'focus' ? 'Focus' : 'Break';
        updateRing();
      }

      document.querySelectorAll('.mode-btn').forEach((btn) => {
        btn.addEventListener('click', () => setMode(btn.dataset.mode));
      });

      startBtn.addEventListener('click', start);
      pauseBtn.addEventListener('click', pause);
      resetBtn.addEventListener('click', reset);

      darkToggle.addEventListener('click', () => {
        const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
        if (isDark) {
          document.documentElement.removeAttribute('data-theme');
          darkToggle.classList.remove('on');
          localStorage.setItem(STORAGE_KEYS.darkMode, '0');
        } else {
          document.documentElement.setAttribute('data-theme', 'dark');
          darkToggle.classList.add('on');
          localStorage.setItem(STORAGE_KEYS.darkMode, '1');
        }
      });

      loadState();
      updateRing();
    })();
  </script>
</body>
</html>
